---
title: "remove-false-positives"
author: "Andrew Edwards"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{remove-false-positives}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Simple example

The object `small_example` has one mock sample and three non-mock samples, with four
mock species in the mock sample and three non-mock species. *Update if change
terminology*. The first column identifies the sample, and remaining columns are
m1, m2, m3 and m4 for the four mock species, and 1, 2 and 3 for the non-mock species.
Corresponding entries are the number of reads of each species in each sample.


```{r, echo=TRUE, results='asis', eval=FALSE}
small_example
```

```{r, echo=FALSE, results='asis'}
# kable() is to display the results for vignette, but the chunk above is what you
#  would run in command line. Thus most chunks here are repeated to format the output.
knitr::kable(small_example)      
```

To remove the false positives use the function `remove_false_pos()`:

```{r, echo=TRUE, results='asis', eval=FALSE}
small_removed <- remove_false_pos(small_example)
small_removed
```

```{r, echo=FALSE, results='asis'}
small_removed <- remove_false_pos(small_example)
knitr::kable(small_removed)
```

To see which reads were set to zero use `which_set_to_zero()`:

```{r, echo=TRUE, results='asis', eval=FALSE}
small_set_to_zero <- which_set_to_zero(small_example, small_removed)
small_set_to_zero
```

```{r, echo=FALSE, results='asis'}
small_set_to_zero <- which_set_to_zero(small_example, small_removed)
knitr::kable(small_set_to_zero)
```

That used the default value of 0.2 for the parameter $\alpha$, which is the
tolerance for ...**add text**

To test sensitivity to $\alpha$ use the function `change_alpha()` for a vector
of $\alpha$ values:


```{r, echo=TRUE, results='asis'}
alpha_values <- seq(0, 1, 0.1)
small_sens_alpha <- change_alpha(small_example, alpha.vec = alpha_values)
```

which returns a list containing:

- the number of reads set to zero (for each value of `alpha_values`)

```{r, echo=TRUE}
small_sens_alpha$num.zeroed
```

- the number of mock species left in non-mock samples (**check**)
```{r, echo=TRUE}
small_sens_alpha$num.mock.sp.left
```

- the number of non-mock (check**?) samples remaining with non-mock species
```{r, echo=TRUE}
small_sens_alpha$num.samp.rem.with.mock.sp
```

- a data frame (tibble) for each value of `alpha_values`,
for example

```{r, echo=TRUE}
alpha_values[6]
```

```{r, echo=TRUE, eval=FALSE}
small_sens_alpha$out.list[[6]]
```

```{r, echo=FALSE}
knitr::kable(small_sens_alpha$out.list[[6]])
```

and


```{r, echo=TRUE}
alpha_values[7]
```

```{r, echo=TRUE, eval=FALSE}
small_sens_alpha$out.list[[7]]
```

```{r, echo=FALSE}
knitr::kable(small_sens_alpha$out.list[[7]])
```

Note how the read of 10 for sample 2 and species 2 gets kept for $\alpha=0.5$
but zeroed for $\alpha=0.6$.

## Big example

The more realistic `big_example` has ** mock samples and ** non-mock samples,
with ...

```{r, echo=TRUE, results='asis', eval=FALSE}
big_example
```

```{r, echo=FALSE, results='asis'}
knitr::kable(big_example)
```

To remove the false positives:

```{r, echo=TRUE, results='asis', eval=FALSE}
big_removed <- remove_false_pos(big_example)
big_removed
```

```{r, echo=FALSE, results='asis'}
big_removed <- remove_false_pos(big_example)
knitr::kable(big_removed)
```

And again, to see which reads were set to zero use `which_set_to_zero()`:

```{r, echo=TRUE, results='asis', eval=FALSE}
big_set_to_zero <- which_set_to_zero(big_example, big_removed)
big_set_to_zero
```

```{r, echo=FALSE, results='asis'}
big_set_to_zero <- which_set_to_zero(big_example, big_removed)
knitr::kable(big_set_to_zero)
```

**To test sensitivity to** $\alpha$, **do as above but just plot the results**


## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
#plot(tolerance, num.removed,
#     xlab = "Tolerance level",
#     ylab = "Number of suspected false positives removed")
#points(tolerance, num.mock.sp.left, col="red")
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```
